# EnvironmentLoop 클래스
환경 루프는 액터와 환경의 상호작용 루프를 실행하며 `EnvironmentLoop` 클래스로 정의돼 있다

![환경 루프 클래스의 구성도](img/environmentloop_class_diagram.png)

## EnvironmentLoop

### 속성
* **환경(`env`)**: 강화학습 환경을 제공하는 객체이다. 다양한 강화학습 환경과 연동할 수 있으며 이 책에서 정의하는 강화학습 프레임워크에는 OpenGym 패키지와 연동되는 환경 클래스가 구현돼 있다. 설정에 환경 래퍼(env_wrapper)를 'opengym'으로 설정하고 환경 이름(config.env_name)을 지정하면 OpenGym 패키지에서 지원하는 모든 환경을 실행할 수 있다.
* **액터(`actor`)**: 에이전트를 대리해서 환경과 상호작용을 하는 프록시 모듈이다.
* **렌더링 여부(`b_render`)**: 강화학습 환경을 화면에 렌더링할지 여부를 나타낸다.
* **통계 정보(`stats`)**: 환경 루프의 실행 통계로 {에피소드 실행 횟수, 에피소드 리턴의 누적 값, 에피소드 길이의 누적 값}을 딕셔너리로 저장한다.
* **환경 루프 카운터**
  * **환경 루프 타입 스텝 수(`n_timesteps_in_envloop`)**: 환경 루프에서 실행한 타입 스텝 수
  * **환경 루프 에피소드 수(`n_episodes_in_envloop`)**: 환경 루프에서 실행한 에피소드 수
* **런 메서드 카운터**
  * **런 메서드 타입 스텝 수(`n_timesteps_in_run`)**: `run()` 메서드 호출 시 실행한 타입 스텝 수
  * **런 메서드 에피소드 수(`n_episodes_in_run`)**: `run()` 메서드 호출 시 실행한 에피소드 수
* **에피소드 카운터**
  * **에피소드 타입 스텝 수(`n_timesteps_in_episode`)**: 실행 중인 에피소드의 타입 스텝 수
  * **에피소드 리턴(`return_in_episode`)**: 실행 중인 에피소드의 리턴(즉 보상의 합)

### 메서드
#### 초기화
* **`__init__`**: ➊ 환경과 액터를 생성하고 ➋ 환경 루프 카운터 ➌ 통계 정보 ➍ 에피소드를 초기화한다.
* **`make_environment`**: 환경 루프에서 사용할 환경을 생성한다.
* make_actor: 환경 루프에서 사용할 액터를 생성한다.
#### 환경 루프 실행
* **`run`**: 지정된 타입 스텝 수 또는 에피소드 수만큼 액터와 환경의 상호작용을 실행하고 경로 데이터와 통계 정보를 반환한다. 환경 루프 실행 초기화 및 결과 생성, 에피소드 초기화
* **`init_run`**: run() 메서드를 실행하기 위해 ➊ 런 메서드 카운터와 ➋ 액터의 롤아웃 버퍼를 초기화 한다.
* **`final_result`**: run() 메서드의 실행 결과인 {경로 데이터, 환경 루프 타임 스텝 수, 환경 루프 에피소드 수, 통계 정보}를 포함하는 딕셔너리를 생성한다.
* **`reset_episode`**: 새로운 에피소드를 실행하기 위해 ➊ 환경과 ➋ 에피소드 카운터를 초기화 한다.
#### 행동 선택
* **`select_action`**: 액터가 환경과 상호작용을 하기 위해 행동을 선택한다. 워밍업 상태이면 환경에서 제공하는 랜덤한 행동을 선택하고, 워밍업 상태가 아니면 액터를 통해 행동을 선택한다.
#### 네트워크 동기화
* **`update_policy`**: 에이전트의 네트워크 상태(파라미터와 버퍼)를 액터의 네트워크에 로딩한다.
#### 트랜지션 데이터 생성
* **`pre_transition_data`**: 에이전트와 환경의 상호작용 이전 데이터 {st}를 생성한다.
* **`post_transition_data`**: 에이전트와 환경의 상호작용 이후 데이터 {at, rt, st+1, et}를 생성한다.
#### 실행 통계
* **`init_stats`**: 환경 루프의 실행 통계 정보 딕셔너리를 생성한다.
* **`reset_stats`**: 통계 정보 딕셔너리를 초기화한다.
* **`update_stats`**: 통계 정보 딕셔너리에 저장된 통계량을 업데이트한다.